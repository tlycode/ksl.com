Insticator.logger = (function () { "use strict"; function getParameterByName(name) { var regexS = "[\\?&]" + name + "=([^&#]*)"; var regex = new RegExp(regexS); var results = regex.exec(window.location.search); if (results === null) { return ""; } return decodeURIComponent(results[1].replace(/\+/g, ' ')); } var showLog = getParameterByName("insticator_log"); return { logMessage: function(msg) { if (showLog) { console.log("INSTICATOR_MESSAGE: " + msg); } } } })(); try { Insticator.tracking = { variables: { embedUUID: "UNKNOWN", embedIsActivated: "UNKNOWN", adIsActivated: "true", adUnitsConfigured: "UNKNOWN", adUnitsOnPage: [], siteUUID: "ba00e54f-23c4-4e2d-b37d-416fdeab53e6", embeds: {}, pageUrl: "UNKNOWN" }, makeAjaxCall: function(method, url, data, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 && xmlHttp.status == 200) { callback(xmlHttp.responseText); } }; xmlHttp.open(method, url, true); xmlHttp.setRequestHeader("Content-type", "application/json"); var jsonData = JSON.stringify(data); xmlHttp.send(jsonData); }, checkBodyCode: function() { var insticatorContainerElement = document.getElementById("insticator-container"); if(insticatorContainerElement) { var insticatorBodyScript = insticatorContainerElement.getElementsByTagName("script"); if(insticatorBodyScript) { for(var i=0; i<insticatorBodyScript.length; i++) { var regex = /[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}/i; var bodyCode = insticatorBodyScript[i].innerHTML; var found = bodyCode.match(regex); if(found) { Insticator.tracking.variables.embedUUID = found[0]; Insticator.logger.logMessage("widgetUUID: " + Insticator.tracking.variables.embedUUID); break; } } if(Insticator.tracking.variables.embedUUID === "UNKNOWN") { Insticator.logger.logMessage("widgetUUID not available"); } } else { Insticator.logger.logMessage("insticatorBodyScript not available"); } } else { Insticator.logger.logMessage("insticatorContainerElement not available"); } }, firePageviewEvent: function() { Insticator.logger.logMessage("Fire pageview event, data: " + JSON.stringify(Insticator.tracking.variables)); var url = "https://dashboard.insticator.com/sites/pageview"; Insticator.tracking.makeAjaxCall("POST", url, Insticator.tracking.variables, function(data){ console.log(data); }); }, checkEmbedCodeAndSettingOnPage: function() { Insticator.tracking.checkBodyCode(); if(Insticator.tracking.variables.embedUUID !== "UNKNOWN") { if(Insticator.tracking.variables.embeds.hasOwnProperty(Insticator.tracking.variables.embedUUID)) { Insticator.tracking.variables.embedIsActivated = Insticator.tracking.variables.embeds[Insticator.tracking.variables.embedUUID]; } else { Insticator.logger.logMessage("embedUUID does not existing."); } } }, formatEmbedAndAdSetting: function() { Insticator.tracking.variables.embeds['3083a4d6-8a2a-41a7-b2e7-c1bb4c039283'] = true; ; var array = []; array.push("div-insticator-ad-1"); array.push("div-insticator-ad-10"); array.push("div-insticator-ad-11"); array.push("div-insticator-ad-12"); array.push("div-insticator-ad-13"); array.push("div-insticator-ad-14"); array.push("div-insticator-ad-2"); array.push("div-insticator-ad-3"); array.push("div-insticator-ad-4"); array.push("div-insticator-ad-5"); array.push("div-insticator-ad-6"); array.push("div-insticator-ad-7"); array.push("div-insticator-ad-8"); array.push("div-insticator-ad-9"); ; Insticator.tracking.variables.adUnitsConfigured = array.toString(); }, checkAdUnitsOnPage: function() { var array = []; for(var i=1; i<10; i++) { var elem = document.getElementById('div-insticator-ad-' + i); if(elem) { array.push(elem.id); } } Insticator.tracking.variables.adUnitsOnPage = array.toString(); }, sendPageview: function() { Insticator.tracking.formatEmbedAndAdSetting(); Insticator.tracking.checkEmbedCodeAndSettingOnPage(); Insticator.tracking.checkAdUnitsOnPage(); Insticator.tracking.getPageUrl(); }, documentReady: function(fn) { if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") { Insticator.logger.logMessage("dom ready!"); fn(); } else { Insticator.logger.logMessage("dom not ready, set up listener"); document.addEventListener('DOMContentLoaded', fn); } }, getPageUrl: function() { var topWindowPageUrl = "N/A"; try { topWindowPageUrl = window.top.location.href; } catch(e) { Insticator.logger.logMessage("top window is not accessible."); } Insticator.tracking.variables.pageUrl = topWindowPageUrl === "N/A" ? document.referrer : document.location.href; return Insticator.tracking.variables.pageUrl; } }; Insticator.tracking.documentReady(Insticator.tracking.sendPageview); } catch(e) { console.error("Traffic tracking code error: ", e.message); } try { Insticator.utils = {}; Insticator.utils.setCookie = function (cname, cvalue, exdays) { Insticator.logger.logMessage("setCookie " + cname + " value " + cvalue); var d = new Date(); d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000)); var expires = "expires=" + d.toUTCString(); document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/"; }; Insticator.utils.getCookie = function (cname) { var name = cname + "="; var decodedCookie = ""; try { decodedCookie = decodeURIComponent(document.cookie); } catch(e) { decodedCookie = document.cookie; Insticator.logger.logMessage("Not able to decode cookie ", e.message); } var ca = decodedCookie.split(';'); for (var i = 0; i < ca.length; i++) { var c = ca[i]; while (c.charAt(0) == ' ') { c = c.substring(1); } if (c.indexOf(name) == 0) { return c.substring(name.length, c.length); } } return ""; }; } catch(e) { console.error("Cookie utils code error: ", e.message); } try { Insticator.ad.settings = { floorGroup: "ctrl_group", floorGroupSetting: { tier1: JSON.parse('{"ctrl_group":100.0}'), tier2: JSON.parse('{"ctrl_group":100.0}'), tier3: JSON.parse('{"ctrl_group":100.0}'), tier4: JSON.parse('{"ctrl_group":100.0}') }, postBidFloorSetting: { tier1: JSON.parse('{"ctrl_group":{"webHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"sekindo":0.01,"districtm":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01},"mobileHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"sekindo":0.01,"districtm":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01}}}'), tier2: JSON.parse('{"ctrl_group":{"webHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"pulsepoint":0.01,"conversant":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01},"mobileHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"pulsepoint":0.01,"conversant":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01}}}'), tier3: JSON.parse('{"ctrl_group":{"webHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01},"mobileHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"openx":0.01,"sovrn":0.01,"aol":0.01}}}'), tier4: JSON.parse('{"ctrl_group":{"webHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"sovrn":0.01,"openx":0.01,"aol":0.01},"mobileHardFloor":{"gumgum":0.01,"sonobi":0.01,"smartadserver":0.01,"brealtime":0.01,"districtm":0.01,"sekindo":0.01,"rhythmone":0.01,"appnexus":0.01,"33across":0.01,"pubmatic":0.01,"indexexchange":0.01,"rubicon":0.01,"conversant":0.01,"pulsepoint":0.01,"sovrn":0.01,"openx":0.01,"aol":0.01}}}') }, optimization: JSON.parse('{}'), calculateFinalBid: function(bid) { var finalCpm = bid; var device = Insticator.helper.isMobileDevice ? "mobile" : "desktop"; var model = this.optimization["TIER_ONE"][this.floorGroup][device]; if(typeof model !== "undefined") { var countryCode = Insticator.settings.visitorGeo; finalCpm = insticator_algo.calculateFinalValue(countryCode, bid, model); } else { Insticator.logger.logMessage("No optimization model for this group."); } return finalCpm; }, passbackInfoJson: { DESKTOP: JSON.parse('{}'), MOBILE: JSON.parse('{}') }, passbackCreativeMap: { default : "" }, embedOverlayAd: JSON.parse('{"3083a4d6-8a2a-41a7-b2e7-c1bb4c039283":{"mobile":[],"web":[]}}'), autoRefreshIntervalLowerBound: 35000, autoRefreshIntervalUpperBound: 55000, excludeInitialLoadAdX: false, excludeClickRefreshAdX: false, excludeAutoRefreshAdX: !true, autoRefreshCounter: 0, autoRefreshCap: 20000, impressionType: { INITIAL_LOAD: "initial_load", EVENT_BASED_REFRESH: "event_based_refresh", TIME_BASED_REFRESH: "time_based_refresh" }, randomFloorGroup: function(tier) { if(tier === "UNKNOWN") { Insticator.logger.logMessage("Unknown tier, consider as tier 1."); tier = "1"; } var tierFloorGroup = Insticator.ad.settings.floorGroupSetting["tier"+tier]; var rand = Math.floor(100 * Math.random()); var base = 0; for (var group in tierFloorGroup) { if (rand < tierFloorGroup[group] + base) { Insticator.ad.settings.floorGroup = group; break; } else { base += tierFloorGroup[group]; } } Insticator.logger.logMessage("floorGroup: " + Insticator.ad.settings.floorGroup); }, getPostBidFloor: function(tier, group, isMobile, bidder) { var tierFloor=Insticator.ad.settings.postBidFloorSetting["tier"+tier]; var groupFloor=tierFloor[group]; var platformFloor=isMobile ? groupFloor["mobileHardFloor"] : groupFloor["webHardFloor"]; var sspFloor=platformFloor[bidder]; return sspFloor; } }; Insticator.settings = { tier1GeoList: "AD,AE,AF,AG,AI,AL,AM,AN,AO,AQ,AR,AS,AT,AU,AW,AX,AZ,BA,BB,BD,BE,BF,BG,BH,BI,BJ,BL,BM,BN,BO,BQ,BR,BS,BT,BV,BW,BY,BZ,CA,CC,CD,CF,CG,CH,CI,CK,CL,CM,CN,CO,CR,CU,CV,CW,CX,CY,CZ,DE,DJ,DK,DM,DO,DZ,EC,EE,EG,EH,ER,ES,ET,FI,FJ,FK,FM,FO,FR,GA,GB,GD,GE,GF,GG,GH,GI,GL,GM,GN,GP,GQ,GR,GS,GT,GU,GW,GY,HK,HM,HN,HR,HT,HU,ID,IE,IL,IM,IN,IO,IQ,IR,IS,IT,JE,JM,JO,JP,KE,KG,KH,KI,KM,KN,KP,KR,KW,KY,KZ,LA,LB,LC,LI,LK,LR,LS,LT,LU,LV,LY,MA,MC,MD,ME,MF,MG,MH,MK,ML,MM,MN,MO,MP,MQ,MR,MS,MT,MU,MV,MW,MX,MY,MZ,NA,NC,NE,NF,NG,NI,NL,NO,NP,NR,NU,NZ,OM,PA,PE,PF,PG,PH,PK,PL,PM,PN,PR,PS,PT,PW,PY,QA,RE,RO,RS,RU,RW,SA,SB,SC,SD,SE,SG,SH,SI,SJ,SK,SL,SM,SN,SO,SR,SS,ST,SV,SX,SY,SZ,TC,TD,TF,TG,TH,TJ,TK,TL,TM,TN,TO,TR,TT,TV,TW,TZ,UA,UG,UM,US,UY,UZ,VA,VC,VE,VG,VI,VN,VU,WF,WS,YE,YT,ZA,ZM,ZW", tier2GeoList: "", tier3GeoList: "", tier4GeoList: "", visitorGeo: "UNKNOWN", visitorFloorTier:"UNKNOWN", visitorGeoCookieName: "visitorGeo", visitorFloorTierCookieName: "visitorFloorTier", makeAjaxCall: function(theUrl, callback) { var xmlHttp=new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 && xmlHttp.status == 200) { callback(xmlHttp.responseText); } }; xmlHttp.onerror= function(e) { Insticator.logger.logMessage("Error fetching " + theUrl); if (theUrl === "https://geoip.insticator.com/json/") { Insticator.settings.visitorFloorTier = '1'; Insticator.utils.setCookie(Insticator.settings.visitorGeoCookieName, 'US',1); } }; xmlHttp.open("GET", theUrl, true); xmlHttp.send(null); }, calculateVisitorFloorTier: function(trafficSource) { Insticator.logger.logMessage("trafficSource: " + trafficSource); var sourceJson=JSON.parse(trafficSource); if(sourceJson.hasOwnProperty("country_code")) { Insticator.settings.visitorGeo = sourceJson["country_code"]; if(Insticator.settings.tier1GeoList.indexOf(Insticator.settings.visitorGeo)> -1) { Insticator.settings.visitorFloorTier = "1"; } else if(Insticator.settings.tier2GeoList.indexOf(Insticator.settings.visitorGeo) > -1) { Insticator.settings.visitorFloorTier = "2"; } else if(Insticator.settings.tier3GeoList.indexOf(Insticator.settings.visitorGeo) > -1) { Insticator.settings.visitorFloorTier = "3"; } else { Insticator.settings.visitorFloorTier = "4"; } Insticator.logger.logMessage("Insticator.settings.visitorFloorTier: " + Insticator.settings.visitorFloorTier); Insticator.utils.setCookie(Insticator.settings.visitorGeoCookieName, Insticator.settings.visitorGeo, 1); Insticator.utils.setCookie(Insticator.settings.visitorFloorTierCookieName, Insticator.settings.visitorFloorTier, 1); Insticator.ad.settings.randomFloorGroup(Insticator.settings.visitorFloorTier); } else { Insticator.logger.logMessage("countryCode not available in sourceJson: " + sourceJson); } }, checkVisitorFloorTier: function() { Insticator.settings.visitorFloorTier = Insticator.utils.getCookie(Insticator.settings.visitorFloorTierCookieName); Insticator.ad.settings.randomFloorGroup(Insticator.settings.visitorFloorTier); if(Insticator.settings.visitorFloorTier !== "") { Insticator.logger.logMessage("find in cookie! visitorFloorTier: " + Insticator.settings.visitorFloorTier); Insticator.settings.visitorGeo = Insticator.utils.getCookie(Insticator.settings.visitorGeoCookieName); } else { Insticator.logger.logMessage("not in cookie"); Insticator.settings.makeAjaxCall("https://geoip.insticator.com/json/", Insticator.settings.calculateVisitorFloorTier); } } }; Insticator.settings.checkVisitorFloorTier(); try{ Insticator.embedGeoBlockingMap = {}; Insticator.blockAds = false; Insticator.geoBlockingAdsCookieName = "Insticator.geoBlockAds-ba00e54f-23c4-4e2d-b37d-416fdeab53e6"; Insticator.geoBlockedEmbedsCookieName = "Insticator.geoBlockedEmbeds-ba00e54f-23c4-4e2d-b37d-416fdeab53e6"; Insticator.geoBlockedEmbedList = []; Insticator.embedGeoBlockingMap['3083a4d6-8a2a-41a7-b2e7-c1bb4c039283'] = ''; function getVisitorGeoAndCheckBlocking(trafficSource) { Insticator.logger.logMessage("trafficSource: " + trafficSource); var sourceJson=JSON.parse(trafficSource); Insticator.logger.logMessage("sourceJson: " + sourceJson); if(sourceJson.hasOwnProperty("country_code")) { Insticator.settings.visitorGeo = sourceJson["country_code"]; } Insticator.utils.setCookie(Insticator.settings.visitorGeoCookieName, Insticator.settings.visitorGeo, 1); for(embedUUID in Insticator.embedGeoBlockingMap) { var blockedGEOList=Insticator.embedGeoBlockingMap[embedUUID].split(','); var embedIsBlockedByGeo=blockedGEOList.indexOf(Insticator.settings.visitorGeo) > -1; if(embedIsBlockedByGeo) { Insticator.geoBlockedEmbedList.push(embedUUID); } Insticator.blockAds = Insticator.blockAds || embedIsBlockedByGeo; } Insticator.utils.setCookie(Insticator.geoBlockingAdsCookieName, Insticator.blockAds, 1); Insticator.utils.setCookie(Insticator.geoBlockedEmbedsCookieName, JSON.stringify(Insticator.geoBlockedEmbedList), 1); }; (function checkBlockVisitorGeo() { var blockAds=Insticator.utils.getCookie(Insticator.geoBlockingAdsCookieName); if(blockAds !== "") { Insticator.logger.logMessage("find in cookie! blockAds: " + blockAds); Insticator.blockAds = blockAds== "true"; var geoBlockedEmbedListCookie=Insticator.utils.getCookie(Insticator.geoBlockedEmbedsCookieName); Insticator.geoBlockedEmbedList = JSON.parse(geoBlockedEmbedListCookie); } else { Insticator.logger.logMessage("GeoBlocking: visitorGeo not in cookie"); Insticator.settings.makeAjaxCall("https://geoip.insticator.com/json/", getVisitorGeoAndCheckBlocking); } })(); } catch(e) { console.error("Geo blocking code error: ", e.message); } try { Insticator.b2cCookieId; Insticator.dmpCookieId; Insticator.host; Insticator.stopPostingMessageToB2CIframe = false; (function() { var environment="dashboard.insticator.com"; if (environment.includes("insticator")) { Insticator.host = "insticator.com"; } else { Insticator.host = "hunchme.com"; } })(); function postUserProfileToDmp(response) { Insticator.logger.logMessage(response); var dmpUserProfileWithChecksum=JSON.parse(response); if (dmpUserProfileWithChecksum['status'] === 'success') { var dmpUserProfileJson=dmpUserProfileWithChecksum['dmpUserProfile']; var checksum=dmpUserProfileWithChecksum['checksum']; var dmpProfilePostUrl="https://lb.insticator.com/BR/push?h=" + checksum; Insticator.tracking.makeAjaxCall("POST", dmpProfilePostUrl, dmpUserProfileJson, function(data){ Insticator.logger.logMessage("profile posted " + data); }); } }; function getUserProfileToSendToDmp() { Insticator.logger.logMessage("In getUserProfileToSendToDmp"); var getDmpProfileUrl="https://ca." + Insticator.host + "/v1/sitecontentanalysis/dmp"; var siteUUID=Insticator.tracking.variables.siteUUID; var embedUUID=Insticator.tracking.variables.embedUUID === 'UNKNOWN' ? null : Insticator.tracking.variables.embedUUID; var pageUrl=Insticator.tracking.variables.pageUrl; if (pageUrl === "UNKNOWN" || pageUrl=== "") { pageUrl="https://www.ksl.com"; } var fetchProfileUrl=getDmpProfileUrl + "?siteUUID=" + siteUUID + "&embedUUID=" + embedUUID + "&siteUrl=" + encodeURIComponent(pageUrl) + "&dmpCookieId=" + Insticator.dmpCookieId; Insticator.settings.makeAjaxCall(fetchProfileUrl, postUserProfileToDmp); }; function bindEvent(element, eventName, eventHandler) { if (element.addEventListener) { element.addEventListener(eventName, eventHandler, false); } else if (element.attachEvent) { element.attachEvent('on' + eventName, eventHandler); } }; bindEvent(window, 'message', function (e) { var b2cHost="b2c." + Insticator.host; if (e.origin.indexOf(b2cHost) >= 0) { Insticator.stopPostingMessageToB2CIframe = true; window['insticatorUserTrackingMessage'] = e.data; if (e.data.hasOwnProperty('userId')) { Insticator.b2cCookieId = e.data.userId; Insticator.dmpCookieId = e.data.dmpCookieId; getUserProfileToSendToDmp(); } } }); function checkUserLocation() { Insticator.logger.logMessage("In checkUserLocation"); const euCounties=['BE', 'BG', 'CZ', 'DK','DE', 'EE', 'IE', 'EL', 'ES', 'FR', 'HR', 'IT', 'CY', 'LV', 'LT', 'LU', 'HU', 'MT', 'NL', 'AT', 'PL', 'PT', 'RO', 'SI', 'SK', 'FI', 'SE', 'UK']; if (euCounties.indexOf(Insticator.settings.visitorGeo) >= 0) { sendMessageToInsticatorIframe({privacyPolicyRegion : true}); } else { sendMessageToInsticatorIframe({privacyPolicyRegion : false}); } }; function sendMessageToInsticatorIframe(message) { message.fromInsticator = true; document.getElementById("insticatorUserTrackingIframe").contentWindow.postMessage(message, '*'); Insticator.logger.logMessage("message posted to insticator iframe"); }; function checkB2CIframeLoaded() { Insticator.logger.logMessage("In checkB2CIframeLoaded, stopPostingMessageToB2CIframe " + Insticator.stopPostingMessageToB2CIframe); if (Insticator.stopPostingMessageToB2CIframe) { return; } var b2cIframe=document.getElementById('insticatorUserTrackingIframe'); if (b2cIframe) { checkUserLocation(); } window.setTimeout(checkB2CIframeLoaded, 500); }; (function createB2CIframe() { Insticator.settings.dmpEnabled = ("true" === "true"); if (Insticator.settings.dmpEnabled && document.getElementById('insticatorUserTrackingIframe') === null && typeof window.top['instcatorIframeLoaded'] === 'undefined') { Insticator.logger.logMessage("In createB2CIframe"); window.top['instcatorIframeLoaded'] = true; var iframe=document.createElement('iframe'); iframe.setAttribute("id", "insticatorUserTrackingIframe"); iframe.style.display = "none"; iframe.src = "https://b2c." + Insticator.host + "/v4/pages/usertracking"; document.body.appendChild(iframe); checkB2CIframeLoaded(); } })(); } catch(e) { console.error("DMP cookie fetch error: ", e.message); } Insticator.helper = (function () { return { isMobileDevice: (function(){return/(android|bb\d |meego). mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))?!0:!1})(), }; }()); var PREBID_TIMEOUT=1500; var PREBID_MOBILE_TIMEOUT=1500; var REFRESH_TIMEOUT=1500; var divsWithAdsShowInDFPForFirstTime=[]; Insticator.ad.ready = false; Insticator.ad.hbFills = {}; Insticator.ad.refreshAdIntervalForAdX = 30000; var googletag=googletag || {}; googletag.cmd = googletag.cmd || []; Insticator.adSlots = {}; function insticator_defineAdSlots() { googletag.cmd.push(function () { if (!Insticator.helper.isMobileDevice) { Insticator.adSlots['div-insticator-ad-1'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_1', [300, 250], 'div-insticator-ad-1').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-10'] = googletag.defineSlot('/27794161/ksl.com_Web_300x600_4', [300, 600], 'div-insticator-ad-10').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-11'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_3', [300, 250], 'div-insticator-ad-11').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-12'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_4', [300, 250], 'div-insticator-ad-12').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-13'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_5', [300, 250], 'div-insticator-ad-13').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-14'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_6', [300, 250], 'div-insticator-ad-14').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-2'] = googletag.defineSlot('/27794161/ksl.com_Web_300x250_2', [300, 250], 'div-insticator-ad-2').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-3'] = googletag.defineSlot('/27794161/ksl.com_Web_728x90_1', [728, 90], 'div-insticator-ad-3').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-4'] = googletag.defineSlot('/27794161/ksl.com_Web_728x90_2', [728, 90], 'div-insticator-ad-4').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-5'] = googletag.defineSlot('/27794161/ksl.com_Web_728x90_3', [728, 90], 'div-insticator-ad-5').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-6'] = googletag.defineSlot('/27794161/ksl.com_Web_728x90_4', [728, 90], 'div-insticator-ad-6').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-7'] = googletag.defineSlot('/27794161/ksl.com_Web_300x600_1', [300, 600], 'div-insticator-ad-7').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-8'] = googletag.defineSlot('/27794161/ksl.com_Web_300x600_2', [300, 600], 'div-insticator-ad-8').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-9'] = googletag.defineSlot('/27794161/ksl.com_Web_300x600_3', [300, 600], 'div-insticator-ad-9').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); } else { Insticator.adSlots['div-insticator-ad-1'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_1', [300, 250], 'div-insticator-ad-1').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-10'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_10', [300, 250], 'div-insticator-ad-10').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-11'] = googletag.defineSlot('/27794161/ksl.com_Mobile_320x50_1', [320, 50], 'div-insticator-ad-11').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-12'] = googletag.defineSlot('/27794161/ksl.com_Mobile_320x50_2', [320, 50], 'div-insticator-ad-12').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-13'] = googletag.defineSlot('/27794161/ksl.com_Mobile_320x50_3', [320, 50], 'div-insticator-ad-13').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-14'] = googletag.defineSlot('/27794161/ksl.com_Mobile_320x50_4', [320, 50], 'div-insticator-ad-14').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-2'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_2', [300, 250], 'div-insticator-ad-2').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-3'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_3', [300, 250], 'div-insticator-ad-3').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-4'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_4', [300, 250], 'div-insticator-ad-4').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-5'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_5', [300, 250], 'div-insticator-ad-5').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-6'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_6', [300, 250], 'div-insticator-ad-6').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-7'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_7', [300, 250], 'div-insticator-ad-7').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-8'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_8', [300, 250], 'div-insticator-ad-8').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); Insticator.adSlots['div-insticator-ad-9'] = googletag.defineSlot('/27794161/ksl.com_Mobile_300x250_9', [300, 250], 'div-insticator-ad-9').addService(googletag.pubads()).setTargeting("refurl", "ksl.com").setTargeting('floor_group', Insticator.ad.settings.floorGroup).setTargeting('hour', (new Date).getUTCHours().toString()).setTargeting('tier', Insticator.settings.visitorFloorTier); } googletag.enableServices(); }); } function insticator_init() { if (instBid.insticator_initSet) return; (function() { var gads=document.createElement('script'); gads.async = true; gads.type = 'text/javascript'; var useSSL='https:' == document.location.protocol; gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js'; var node=document.getElementsByTagName('script')[0]; node.parentNode.insertBefore(gads, node); })(); insticator_defineAdSlots(); googletag.cmd.push(function() { instBid.que.push(function() { instBid.setTargetingForGPTAsync(); }); }); Insticator.ad.ready = true; instBid.insticator_initSet = true; Insticator.ad.loadAllAds(); }; if(Insticator.helper.isMobileDevice) { setTimeout(function() { Insticator.logger.logMessage("Mobile timeout"); insticator_init(); }, PREBID_MOBILE_TIMEOUT); } else { setTimeout(function() { Insticator.logger.logMessage("Desktop timeout"); insticator_init(); }, PREBID_TIMEOUT); } var instBid=instBid || {}; instBid.que = instBid.que || []; (function() { var instBidEle=document.createElement("script"); instBidEle.type = "text/javascript"; instBidEle.async = true; instBidEle.src = "https://df80k0z3fi8zg.cloudfront.net/files/prebid_v_1_24_gumgum.js"; var instBidTargetEl=document.getElementsByTagName("head")[0]; instBidTargetEl.insertBefore(instBidEle, instBidTargetEl.firstChild); })(); var analyticsProviders=[]; if (analyticsProviders.length > 0) { instBid.que.push(function () { instBid.enableAnalytics(analyticsProviders); }); } Insticator.ad.adUnitsMap = {}; if(!Insticator.helper.isMobileDevice) { var adUnits = []; var adUnit = { code: 'div-insticator-ad-1', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '12722772' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418051' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19559' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297219', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747254' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '554933' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-10', mediaTypes: { banner: { sizes: [[300, 600]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672381' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675532' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19568' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297228', size: [300, 600] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '1011984' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576032' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-11', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672382' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675525' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19561' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297229', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '839152' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558535' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-12', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672383' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675526' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19562' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297230', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '1011984' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558536' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-13', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672384' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418054' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19563' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297231', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '1011986' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558531' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-14', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672385' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675528' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19564' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297232', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '1011988' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558533' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-2', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '12722773' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418053' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19560' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297220', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747260' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '554934' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-3', mediaTypes: { banner: { sizes: [[728, 90]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '12722775' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '12728710' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19569' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297221', size: [728, 90] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747254' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '554937' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-4', mediaTypes: { banner: { sizes: [[728, 90]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672375' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675537' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19570' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297222', size: [728, 90] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747260' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576026' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-5', mediaTypes: { banner: { sizes: [[728, 90]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672376' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418056' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19571' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297223', size: [728, 90] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '839152' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576027' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-6', mediaTypes: { banner: { sizes: [[728, 90]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672377' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675539' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19572' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297224', size: [728, 90] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '1011984' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576028' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-7', mediaTypes: { banner: { sizes: [[300, 600]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672378' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675529' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19565' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297225', size: [300, 600] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747254' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576029' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-8', mediaTypes: { banner: { sizes: [[300, 600]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672379' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675530' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19566' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297226', size: [300, 600] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '747260' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576030' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-9', mediaTypes: { banner: { sizes: [[300, 600]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672380' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418055' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19567' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297227', size: [300, 600] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156692', zoneId: '839152' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '576031' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; } else { var adUnits = []; var adUnit = { code: 'div-insticator-ad-1', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '12722776' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418041' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19545' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297233', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '747266' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '554935' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-10', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672394' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418042' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19554' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297242', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1012004' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558520' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-11', mediaTypes: { banner: { sizes: [[320, 50]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '14089821' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14099764' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19555' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297233', size: [320, 50] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688 ', zoneId: '747266' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '586287' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-12', mediaTypes: { banner: { sizes: [[320, 50]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '14089822' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14099765' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19556' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297234', size: [320, 50] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '747268' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '586289' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-13', mediaTypes: { banner: { sizes: [[320, 50]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '14089823' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14099766' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19557' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297235', size: [320, 50] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011990' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '586290' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-14', mediaTypes: { banner: { sizes: [[320, 50]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '14089824' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14099767' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19558' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297236', size: [320, 50] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011992' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '586291' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-2', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '12722777' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418043' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19546' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297234', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '747268' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '554936' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-3', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672387' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '13675515' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19547' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297235', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011990' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558441' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-4', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672388' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418044' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19548' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297236', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011992' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558442' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-5', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672389' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418045' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19549' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297237', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011994' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558439' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-6', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672390' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418046' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19550' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297238', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011996' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558440' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-7', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672391' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418047' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19551' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297239', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1011998' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558532' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-8', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672392' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418048' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19552' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297240', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1012000' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558534' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; var adUnit = { code: 'div-insticator-ad-9', mediaTypes: { banner: { sizes: [[300, 250]], } }, }, bids = []; var bid = { bidder: 'appnexus', params: { placementId: '13672393' } }; bids.push(bid); var bid = { bidder: 'emxdigital', params: { placementId: '14418050' } }; bids.push(bid); var bid = { bidder: 'gumgum', params: { inSlot: '19553' } }; bids.push(bid); var bid = { bidder: 'ix', params: { siteId: '297241', size: [300, 250] } }; bids.push(bid); var bid = { bidder: 'rubicon', params: { accountId: '17062', siteId: '156688', zoneId: '1012002' } }; bids.push(bid); var bid = { bidder: 'sovrn', params: { tagid: '558517' } }; bids.push(bid); adUnit.bids = bids; adUnits.push(adUnit); Insticator.ad.adUnitsMap[adUnit.code] = adUnit; } instBid.que.push(function() { var confiantWrap = function confiantWrap(a,b,c,d,e){function f(a){return(m(a)||"")[s]("/","_")[s]("+","-")}function g(b,c,d){var e=w+n(b)+"&d="+c,f="err__"+1*new Date;k[f]=d;var g="<"+q+" on"+t+'="void('+f+'())" '+r+'="'+e+'" type="text/java'+q+'"></'+q+">";a[v](g)}function h(){var c=f(d+"/"+x.k.hb_bidder[0]+":"+x.k.hb_size[0]),h={wh:c,wd:l.parse(l[u](x)),wr:0};g(c,f(l[u](h)),function(){a[v](b.ad)});var i={prebid:{adId:b.adId,cpm:b.cpm}},j={d:h,t:b.ad,cb:e,id:i};k[d]={},k[d][c]=j}var i=b.bidder,j=b.size,k=a.parentWindow||a.defaultView,l=k.JSON,m=k.btoa,n=k.encodeURIComponent;if(!l||!m)return!1;var o="t",p="i",q="script",r="src",s="replace",t="error",u="stringify",v="wr"+p+o+"e",w="https://"+c+"/?wrapper="+n(d)+"&tpid=",x={k:{hb_bidder:[i],hb_size:[j]}};return h(),a.close(),!0}; var w=window; w._clrm = w._clrm || {}; w._clrm.renderAd = w._clrm.renderAd || instBid.renderAd; var config=w._clrm.prebid || { sandbox: 1 }; var isGoogleFrame=function (c) { return c.tagName === 'IFRAME' && c.id && c.id.indexOf('google_ads_iframe_') > -1; }; var shouldSandbox = function () { var uaToRegexMap = { "mobile": /Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/i, "ios": /(.+)(iPhone|iPad|iPod)(.+)OS[\s|\_](\d)\_?(\d)?[\_]?(\d)?.+/i, "android": /Android/i }, sbStr = "" +config.sandbox; if (sbStr === "1") { return true; } else if (sbStr === "2") { return !navigator.userAgent.match(uaToRegexMap["mobile"]); } else if (sbStr === "3") { return navigator.userAgent.match(uaToRegexMap["mobile"]); } else if (sbStr === "4") { return navigator.userAgent.match(uaToRegexMap["ios"]); } else if (sbStr === "5") { return navigator.userAgent.match(uaToRegexMap["android"]); } else { return false; } }; Node.prototype.appendChild = (function (original) { return function (child) { if (isGoogleFrame(child) && shouldSandbox() && !child.getAttribute('sandbox')) { child.setAttribute('sandbox', 'allow-forms allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation-by-user-activation'); child.setAttribute('data-forced-sandbox', true); } return original.call(this, child); }; }(Node.prototype.appendChild)); instBid.renderAd = function(doc, id) { if (doc && id) { try { var bids = [], bidResponses = instBid.getBidResponses(), highestBids = instBid.getHighestCpmBids(); for (var slot in bidResponses) { bids = bids.concat(bidResponses[slot].bids); } bids = bids.concat(highestBids); var bid, i; for (i=0; i<bids.length; i++) { if (bids[i].adId === id) { bid = bids[i]; break; } } var confiantExcludeBidders = []; var excludeBidder = false; for (i=0; i<confiantExcludeBidders.length; i++) { if (bid.bidder === confiantExcludeBidders[i]) { excludeBidder = true; break; } } if (bid && bid.ad && !excludeBidder) { var docwrite = doc.write; var docclose = doc.close; doc.write = doc.close = function() {}; window._clrm.renderAd(doc, id); delete doc.write; delete doc.close; var callback = function(blockingType, blockingId, isBlocked, wrapperId, tagId, impressionData) { console.log("w00t one more bad ad nixed.", arguments); }; if (!confiantWrap(doc, bid, 'clarium.global.ssl.fastly.net', 'Fseez_-nDyWQXIJsbnoKkKTHXC4', callback)) { doc.write(bid.ad); doc.close(); } return; } } catch (e) { console.log(e); } } window._clrm.renderAd(doc, id); }; }); function getExistingAdUnits() { var adUnitPrefix = "div-insticator-ad-"; var existingAdUnits = []; for (var index = 1; index <= 10; index++) { var adUnitName = adUnitPrefix + index; if (document.getElementById(adUnitName) && Insticator.ad.adUnitsMap[adUnitName]) { Insticator.logger.logMessage("ExistingAdUnit: " + adUnitName); existingAdUnits.push(Insticator.ad.adUnitsMap[adUnitName]); } } return existingAdUnits; } (function checkForUrlsBlocking() { var urlsToBlockAds = []; ; var pageUrl = Insticator.tracking.getPageUrl(); if (typeof pageUrl != 'undefined') { for (index in urlsToBlockAds) { Insticator.logger.logMessage("Insticator.blockAds pageUrl: " + pageUrl); Insticator.logger.logMessage("Insticator.blockAds url: " + urlsToBlockAds[index]); Insticator.logger.logMessage("Insticator.blockAds boolean: " + pageUrl.includes(urlsToBlockAds[index])); if (pageUrl.includes(urlsToBlockAds[index])) { Insticator.logger.logMessage("Insticator.blockAds for: " + pageUrl); Insticator.blockAds = true; break; } } } Insticator.logger.logMessage("Insticator.blockAds: " + Insticator.blockAds); })(); function insticator_getBoostedAdXCPM(cpm) { if(cpm <= 10) { return Math.floor(cpm*100); } else if(cpm <= 20) { return (Math.floor((cpm*50).toFixed(2))/50*100).toFixed(); } else if(cpm <= 100) { return (Math.floor((cpm*2).toFixed(2))/2*100).toFixed(); } else if(cpm <= 1000) { return ((Math.floor(cpm/10)*10)*100).toFixed(); } else { return 100000; } }; function insticator_SetAdXFloorTargeting(containerId, floor) { Insticator.logger.logMessage("Set adx_floor targeting for: " + containerId + " to: " + floor); googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("adx_floor", floor); }); } instBid.que.push(function() { if (!Insticator.blockAds) { var existingAdUnits=getExistingAdUnits(); if (existingAdUnits.length> 0) { instBid.addAdUnits(existingAdUnits); } else { instBid.addAdUnits(adUnits); } instBid.requestBids({ bidsBackHandler: function (bidResponses) { Insticator.logger.logMessage("Got all bid responses"); insticator_init(); } }); } else { Insticator.logger.logMessage("Ads blocked for GEO"); } function insticator_getFinalCPM(cpm) { if(cpm <= 4) { return Math.floor(cpm*100); } else if(cpm <= 8) { return (Math.floor((cpm*50).toFixed(2))/50*100).toFixed(); } else if(cpm <= 12) { return (Math.floor((cpm*20).toFixed(2))/20*100).toFixed(); } else if(cpm <= 16) { return (Math.floor((cpm*10).toFixed(2))/10*100).toFixed(); } else if(cpm <= 20) { return (Math.floor((cpm*5).toFixed(2))/5*100).toFixed(); } else if(cpm <= 40) { return (Math.floor(cpm)*100).toFixed(); } else if(cpm <= 100) { return ((Math.floor(cpm/2)*2)*100).toFixed(); } else if(cpm <= 1000) { return ((Math.floor(cpm/10)*10)*100).toFixed(); } else { return 100000; } }; function insticator_getBidFloor(bidCpm, bid, bidder) { if(Insticator.settings.visitorFloorTier === "UNKNOWN") { Insticator.logger.logMessage("visitorFloorTier not available, consider as Tier 1."); Insticator.settings.visitorFloorTier = "1"; } var hardFloor=Insticator.ad.settings.getPostBidFloor(Insticator.settings.visitorFloorTier, Insticator.ad.settings.floorGroup, Insticator.helper.isMobileDevice, bidder); Insticator.logger.logMessage("Postbid floor for: " + bidder + " on: " + (!Insticator.helper.isMobileDevice ? "desktop" : "mobile") + " is: " + hardFloor); if(bidCpm> 0 && bidCpm < hardFloor) { Insticator.logger.logMessage("New bid for: " + bid.adUnitCode + " at: " + bidCpm + " doesn't reach " + bidder + " hardFloor: " + hardFloor + ", consider as invalid bid."); return 0; } }; instBid.bidderSettings = { standard: { adserverTargeting: [{ key: 'instBid_bidder', val: function(bidResponse) { if (bidResponse.bidderCode === "ix") { return "indexExchange"; } else if(bidResponse.bidderCode === "emxdigital") { return "brealtime"; } else if(bidResponse.bidderCode === "districtm") { return "districtmDMX"; } else { return bidResponse.bidderCode; } } }, { key: 'instBid_adid', val: function(bidResponse) { return bidResponse.adId; } }, { key: 'instBid_pb', val: function(bidResponse) { Insticator.logger.logMessage("New bid for: " + bidResponse.adUnitCode + " from: " + bidResponse.bidderCode + " at cpm: " + bidResponse.cpm); var finalCPM=insticator_getFinalCPM(bidResponse.cpm); var boostedCPM; if(Insticator.ad.settings.floorGroup !== "ctrl_group") { var boostedBidCPM=Insticator.ad.settings.calculateFinalBid(bidResponse.cpm); boostedCPM=insticator_getBoostedAdXCPM(boostedBidCPM); } else { Insticator.logger.logMessage("Not boost for control group"); boostedCPM=finalCPM } if(bidResponse.adUnitCode in Insticator.ad.hbFills) { if(boostedCPM> Insticator.ad.hbFills[bidResponse.adUnitCode].boostedCPM) { Insticator.logger.logMessage("New higher bid for: " + bidResponse.adUnitCode + " with adId: " + bidResponse.adId + " at cpm: " + bidResponse.cpm + " and boost to: " + boostedCPM); Insticator.ad.hbFills[bidResponse.adUnitCode] = {cpm : bidResponse.cpm, adId : bidResponse.adId, bidderCode : bidResponse.bidderCode, boostedCPM: boostedCPM}; } } else { Insticator.ad.hbFills[bidResponse.adUnitCode] = {cpm : bidResponse.cpm, adId : bidResponse.adId, bidderCode : bidResponse.bidderCode, boostedCPM: boostedCPM}; } return finalCPM; } }, { key: 'instBid_size', val: function(bidResponse) { return bidResponse.size; } }] }, "33across": { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "33across") === 0) { return 0; } var discrepancy = 0; discrepancy = 20.0; return bidCpm * (1 - discrepancy / 100); } }, aol: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "aol") === 0) { return 0; } var discrepancy = 0; discrepancy = 1.0; return bidCpm * (1 - discrepancy / 100); } }, appnexus: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "appnexus") === 0) { return 0; } var discrepancy = 0; discrepancy = 13.0; return bidCpm * (1 - discrepancy / 100); } }, conversant: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "conversant") === 0) { return 0; } var discrepancy = 0; discrepancy = 2.0; return bidCpm * (1 - discrepancy / 100); } }, districtmDMX: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "districtm") === 0) { return 0; } var discrepancy = 0; discrepancy = 9.0; return bidCpm * (1 - (10.0 + discrepancy) / 100); } }, districtm: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "districtm") === 0) { return 0; } var discrepancy = 0; discrepancy = 9.0; return bidCpm * (1 - (10.0 + discrepancy) / 100); } }, emxdigital: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "brealtime") === 0) { return 0; } var discrepancy = 0; discrepancy = 5.0; return bidCpm * (1 - (10.0 + discrepancy) / 100); } }, gumgum: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "gumgum") === 0) { return 0; } var discrepancy = 0; discrepancy = 15.0; return bidCpm * (1 - discrepancy / 100); } }, ix: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "indexexchange") === 0) { return 0; } var discrepancy = 0; discrepancy = 4.0; return bidCpm * (1 - discrepancy / 100); } }, openx: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "openx") === 0) { return 0; } var discrepancy = 0; discrepancy = 13.0; return bidCpm * (1 - discrepancy / 100); } }, pubmatic: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "pubmatic") === 0) { return 0; } var discrepancy = 0; discrepancy = 12.0; return bidCpm * (1 - (16.0 + discrepancy) / 100); } }, pulsepoint: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "pulsepoint") === 0) { return 0; } var discrepancy = 0; discrepancy = 15.0; return bidCpm * (1 - discrepancy / 100); } }, rubicon: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "rubicon") === 0) { return 0; } var discrepancy = 0; discrepancy = 10.0; return bidCpm * (1 - (0.0 + discrepancy) / 100); } }, sekindoUM: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "sekindo") === 0) { return 0; } var discrepancy = 0; discrepancy = 35.0; return bidCpm * (1 - discrepancy / 100); } }, sonobi: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "sonobi") === 0) { return 0; } var discrepancy = 0; discrepancy = 4.0; return bidCpm * (1 - discrepancy / 100); } }, sovrn: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "sovrn") === 0) { return 0; } var discrepancy = 0; discrepancy = 15.0; return bidCpm * (1 - discrepancy / 100); } }, rhythmone: { bidCpmAdjustment: function (bidCpm, bid) { if(insticator_getBidFloor(bidCpm, bid, "rhythmone") === 0) { return 0; } var discrepancy = 0; discrepancy = 15.0; return bidCpm * (1 - discrepancy / 100); } } }; }); if(!Insticator.helper.isMobileDevice) { var adUnitSizeListJsonString = '{'; adUnitSizeListJsonString += '"div-insticator-ad-1" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-10" : { "width" : 300, "height" : 600}, '; adUnitSizeListJsonString += '"div-insticator-ad-11" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-12" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-13" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-14" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-2" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-3" : { "width" : 728, "height" : 90}, '; adUnitSizeListJsonString += '"div-insticator-ad-4" : { "width" : 728, "height" : 90}, '; adUnitSizeListJsonString += '"div-insticator-ad-5" : { "width" : 728, "height" : 90}, '; adUnitSizeListJsonString += '"div-insticator-ad-6" : { "width" : 728, "height" : 90}, '; adUnitSizeListJsonString += '"div-insticator-ad-7" : { "width" : 300, "height" : 600}, '; adUnitSizeListJsonString += '"div-insticator-ad-8" : { "width" : 300, "height" : 600}, '; adUnitSizeListJsonString += '"div-insticator-ad-9" : { "width" : 300, "height" : 600}, '; adUnitSizeListJsonString = adUnitSizeListJsonString.slice(0, -2); adUnitSizeListJsonString +='}'; } else { var adUnitSizeListJsonString = '{'; adUnitSizeListJsonString += '"div-insticator-ad-1" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-10" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-11" : { "width" : 320, "height" : 50}, '; adUnitSizeListJsonString += '"div-insticator-ad-12" : { "width" : 320, "height" : 50}, '; adUnitSizeListJsonString += '"div-insticator-ad-13" : { "width" : 320, "height" : 50}, '; adUnitSizeListJsonString += '"div-insticator-ad-14" : { "width" : 320, "height" : 50}, '; adUnitSizeListJsonString += '"div-insticator-ad-2" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-3" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-4" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-5" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-6" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-7" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-8" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString += '"div-insticator-ad-9" : { "width" : 300, "height" : 250}, '; adUnitSizeListJsonString = adUnitSizeListJsonString.slice(0, -2); adUnitSizeListJsonString +='}'; } Insticator.adSlots = {}, Insticator.divAdUnitsMapping = {}; if (!Insticator.helper.isMobileDevice) { Insticator.divAdUnitsMapping['div-insticator-ad-1'] = "/27794161/ksl.com_Web_300x250_1"; Insticator.divAdUnitsMapping['div-insticator-ad-10'] = "/27794161/ksl.com_Web_300x600_4"; Insticator.divAdUnitsMapping['div-insticator-ad-11'] = "/27794161/ksl.com_Web_300x250_3"; Insticator.divAdUnitsMapping['div-insticator-ad-12'] = "/27794161/ksl.com_Web_300x250_4"; Insticator.divAdUnitsMapping['div-insticator-ad-13'] = "/27794161/ksl.com_Web_300x250_5"; Insticator.divAdUnitsMapping['div-insticator-ad-14'] = "/27794161/ksl.com_Web_300x250_6"; Insticator.divAdUnitsMapping['div-insticator-ad-2'] = "/27794161/ksl.com_Web_300x250_2"; Insticator.divAdUnitsMapping['div-insticator-ad-3'] = "/27794161/ksl.com_Web_728x90_1"; Insticator.divAdUnitsMapping['div-insticator-ad-4'] = "/27794161/ksl.com_Web_728x90_2"; Insticator.divAdUnitsMapping['div-insticator-ad-5'] = "/27794161/ksl.com_Web_728x90_3"; Insticator.divAdUnitsMapping['div-insticator-ad-6'] = "/27794161/ksl.com_Web_728x90_4"; Insticator.divAdUnitsMapping['div-insticator-ad-7'] = "/27794161/ksl.com_Web_300x600_1"; Insticator.divAdUnitsMapping['div-insticator-ad-8'] = "/27794161/ksl.com_Web_300x600_2"; Insticator.divAdUnitsMapping['div-insticator-ad-9'] = "/27794161/ksl.com_Web_300x600_3"; } else { Insticator.divAdUnitsMapping['div-insticator-ad-1'] = "/27794161/ksl.com_Mobile_300x250_1"; Insticator.divAdUnitsMapping['div-insticator-ad-10'] = "/27794161/ksl.com_Mobile_300x250_10"; Insticator.divAdUnitsMapping['div-insticator-ad-11'] = "/27794161/ksl.com_Mobile_320x50_1"; Insticator.divAdUnitsMapping['div-insticator-ad-12'] = "/27794161/ksl.com_Mobile_320x50_2"; Insticator.divAdUnitsMapping['div-insticator-ad-13'] = "/27794161/ksl.com_Mobile_320x50_3"; Insticator.divAdUnitsMapping['div-insticator-ad-14'] = "/27794161/ksl.com_Mobile_320x50_4"; Insticator.divAdUnitsMapping['div-insticator-ad-2'] = "/27794161/ksl.com_Mobile_300x250_2"; Insticator.divAdUnitsMapping['div-insticator-ad-3'] = "/27794161/ksl.com_Mobile_300x250_3"; Insticator.divAdUnitsMapping['div-insticator-ad-4'] = "/27794161/ksl.com_Mobile_300x250_4"; Insticator.divAdUnitsMapping['div-insticator-ad-5'] = "/27794161/ksl.com_Mobile_300x250_5"; Insticator.divAdUnitsMapping['div-insticator-ad-6'] = "/27794161/ksl.com_Mobile_300x250_6"; Insticator.divAdUnitsMapping['div-insticator-ad-7'] = "/27794161/ksl.com_Mobile_300x250_7"; Insticator.divAdUnitsMapping['div-insticator-ad-8'] = "/27794161/ksl.com_Mobile_300x250_8"; Insticator.divAdUnitsMapping['div-insticator-ad-9'] = "/27794161/ksl.com_Mobile_300x250_9"; } function insticator_removeFirstIframeInsideElement(containerId) { var iframe = insticator_getFirstIframeInsideElement(containerId); if (!iframe) { return false; } iframe.parentNode.removeChild(iframe); return true; } function insticator_createEmptyIframeInsideElement(containerId, width, height) { var iFrame = document.createElement("iframe"); iFrame.width = width + "px"; iFrame.height = height + "px"; iFrame.frameBorder = "0"; iFrame.scrolling = "no"; iFrame.marginHeight = "0"; iFrame.marginWidth = "0"; iFrame.topmargin = "0"; iFrame.leftmargin = "0"; iFrame.allowtransparency = "true"; document.getElementById(containerId).appendChild(iFrame); return iFrame; } function insticator_updateIFrameContent(targetIFrame, content) { targetIFrame.contentWindow.document.open(); targetIFrame.contentWindow.document.write(content); targetIFrame.contentWindow.document.close(); } function insticator_getFirstIframeInsideElement(containerId) { var adDiv = document.getElementById(containerId); if (!adDiv) { return adDiv; } return adDiv.getElementsByTagName("iframe")[0]; } function insticator_getTargetingString(containerId, excludeAdx, refreshType) { var targetingString = ""; var targetingMap = instBid.getAdserverTargetingForAdUnitCode(containerId); if(typeof targetingMap === "undefined" || targetingMap['instBid_bidder'] === '') { targetingMap = { "instBid_bidder": "nofill", "instBid_pb": "0", "instBid_adid": "nofill" } } for(var key in targetingMap) { targetingString += ".setTargeting('" + key + "','" + targetingMap[key] + "')"; } var customTargetingMap = insticator_getTargetingForSynchronousRendering(excludeAdx, refreshType); for(var key in customTargetingMap) { targetingString += ".setTargeting('" + key + "','" + customTargetingMap[key] + "')"; } Insticator.logger.logMessage("targetingString: " + targetingString); return targetingString; } function insticator_formHBCreative(adUnit, width, height, targetings) { return "<scr" + "ipt src='https://www.googletagservices.com/tag/js/gpt.js'>googletag.cmd.push(function() {googletag.defineSlot('" + adUnit + "', [" + width + ", " + height + "], 'insticatorAd').addService(googletag.pubads())" + targetings + ";googletag.enableServices();});</scr" + "ipt><style>body { margin: 0px !important;}</style><div id='insticatorAd' style='height:250px; width:300px;'><scr" + "ipt>googletag.cmd.push(function() { googletag.display('insticatorAd'); });</scr" + "ipt></div>"; } function insticator_clearAdsUnderContainerId(containerId) { var node=document.getElementById(containerId); if (node) { while (node.hasChildNodes()) { node.removeChild(node.firstChild); } return true; } return false; } function insticator_getPassbackName(containerId) { var deviceType="DESKTOP"; if (Insticator.helper.isMobileDevice) { deviceType="MOBILE"; } var divPassback=Insticator.ad.settings.passbackInfoJson[deviceType]; if (divPassback[containerId]) { return divPassback[containerId]; } return "default"; } function insticator_showCreativeInIframe(containerId, adUnit, width, height, excludeAdx, refreshType) { var iFrame=insticator_getFirstIframeInsideElement(containerId); if(!iFrame) { iFrame=insticator_createEmptyIframeInsideElement(containerId, width, height); } var targetingString=insticator_getTargetingString(containerId, excludeAdx, refreshType); var hbContent=insticator_formHBCreative(adUnit, width, height, targetingString); insticator_updateIFrameContent(iFrame, hbContent); } function insticator_replaceAll(str, find, replace) { return str.replace(new RegExp(find, 'g'), replace); } function insticator_replaceMacros(tag, width, height) { return tag.replace(/{width}/g, width).replace(/{height}/g, height).replace(/{domain}/g, "ksl.com"); } function insticator_getCreativeForPassback(passbackName, width, height) { var creative=Insticator.ad.settings.passbackCreativeMap[passbackName]; if (creative) { creative=insticator_replaceMacros(creative, width, height, "ksl.com"); } return creative; } function insticator_showPassbackInIframe(containerId, passbackName, width, height) { var success=insticator_clearAdsUnderContainerId(containerId); if (success) { var iFrame=insticator_createEmptyIframeInsideElement(containerId, width, height); var creative=insticator_getCreativeForPassback(passbackName, width, height); insticator_updateIFrameContent(iFrame, creative); } else { Insticator.logger.logMessage("Fail to clear ads under: " + containerId); } } function insticator_setNoFillTargeting(containerId) { var targeting=instBid.getAdserverTargetingForAdUnitCode(containerId); if(Object.keys(targeting).length === 0 || typeof targeting['instBid_bidder'] === 'undefined') { Insticator.logger.logMessage("No fill for: " + containerId + " , add no fill targeting"); googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("instBid_bidder", "nofill").setTargeting("instBid_pb", "0").setTargeting("instBid_adid", "nofill"); }); var adUnitsSize=JSON.parse(adUnitSizeListJsonString); var adSize=adUnitsSize[containerId]; if (typeof adSize !== "undefined") { googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("instBid_size", adSize["width"] + "x" + adSize["height"]); }); } } } function insticator_setExcludeAdXTargeting(containerId, excludeAdx) { var excludeAdxValue=excludeAdx ? "Y" : "N"; Insticator.logger.logMessage("Set no adx targeting for: " + containerId + " to: " + excludeAdxValue); googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("Exclude_Adx", excludeAdx ? "Y" : "N"); }); } function insticator_setImpressionTypeTargeting(containerId, refreshType) { Insticator.logger.logMessage("Impression type for: " + containerId + " on: " + refreshType); googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("impression_type", refreshType); }); } function insticator_setFloorGroupTargeting(containerId) { Insticator.logger.logMessage("Set floor_group for: " + containerId + " to: " + Insticator.ad.settings.floorGroup); googletag.cmd.push(function() { Insticator.adSlots[containerId].setTargeting("floor_group", Insticator.ad.settings.floorGroup); }); } function insticator_getTargetingForSynchronousRendering(excludeAdx, refreshType) { var customTargeting={ "impression_type": refreshType, "Exclude_Adx": excludeAdx ? "Y" : "N", "tier": Insticator.settings.visitorFloorTier, "hour": (new Date).getUTCHours().toString(), "floor_group": Insticator.ad.settings.floorGroup, "refurl": "ksl.com" }; return customTargeting; } function insticator_refreshAd(containerId, excludeAdx, refreshType) { var adUnitsSize=JSON.parse(adUnitSizeListJsonString); var adSize=adUnitsSize[containerId]; var hasFill=containerId in Insticator.ad.hbFills; if (hasFill) { Insticator.logger.logMessage("Fill for: " + containerId + ", id:" + Insticator.ad.hbFills[containerId].adId + ", from: " + Insticator.ad.hbFills[containerId].bidderCode + ", cpm: " + Insticator.ad.hbFills[containerId].cpm + " boost to: " + Insticator.ad.hbFills[containerId].boostedCPM); insticator_SetAdXFloorTargeting(containerId, Insticator.ad.hbFills[containerId].boostedCPM); } else { Insticator.logger.logMessage("No fill for: " + containerId); insticator_SetAdXFloorTargeting(containerId, 1); } if (adSize) { var passbackName=insticator_getPassbackName(containerId); Insticator.logger.logMessage("In appendAd, passbackName: " + passbackName); Insticator.logger.logMessage("hasFill: " + hasFill); if (!hasFill && passbackName.toLowerCase() !== "default") { insticator_showPassbackInIframe(containerId, passbackName, adSize["width"], adSize["height"]); } else { insticator_setExcludeAdXTargeting(containerId, excludeAdx); insticator_setNoFillTargeting(containerId); insticator_setImpressionTypeTargeting(containerId, refreshType); insticator_clearAdsUnderContainerId(containerId); if (divsWithAdsShowInDFPForFirstTime.includes(containerId)) { googletag.pubads().refresh([Insticator.adSlots[containerId]]); } else { divsWithAdsShowInDFPForFirstTime.push(containerId); googletag.display(containerId); } } } } function insticator_refreshBids(hoverUnits, excludeAdx, refreshType) { Insticator.logger.logMessage("Clear map"); Insticator.ad.hbFills = {}; if(hoverUnits.length > 0) { insticator_preAdjustAdUnits(hoverUnits); } Insticator.ad.settings.randomFloorGroup(Insticator.settings.visitorFloorTier); for (var key in Insticator.adSlots) { insticator_setFloorGroupTargeting(key); } instBid.que.push(function() { instBid.requestBids({ timeout: REFRESH_TIMEOUT, bidsBackHandler: function() { Insticator.logger.logMessage("All refresh bids back"); instBid.setTargetingForGPTAsync(); for (var i in Insticator.adSlots) { if(hoverUnits.indexOf(i) > -1) { Insticator.logger.logMessage("Not refresh hover unit: " + i); } else { insticator_refreshAd(i, excludeAdx, refreshType); } } } }); }); if(hoverUnits.length > 0) { insticator_postAdjustAdUnits(hoverUnits); } } function insticator_preAdjustAdUnits(hoverUnits) { for(var i in hoverUnits) { Insticator.logger.logMessage("Remove ad unit to be refreshed: " + hoverUnits[i]); instBid.removeAdUnit(hoverUnits[i]); } } function insticator_postAdjustAdUnits(hoverUnits) { for(var i in hoverUnits) { Insticator.logger.logMessage("Add back ad unit: " + hoverUnits[i]); instBid.addAdUnits(Insticator.ad.adUnitsMap[hoverUnits[i]]); } } (function() { "use strict"; var refreshAdBasedOnClickEvent=function(hoverUnits) { if(Insticator.blockAds) { Insticator.logger.logMessage("This geo is blocked event based refresh."); } else { var noRefreshUnits=[]; Insticator.logger.logMessage("Refresh ad based on click event"); if(typeof hoverUnits=== "undefined") { Insticator.logger.logMessage("Refresh all ads"); } else { Insticator.logger.logMessage("Refresh non-hover ads"); if(hoverUnits.indexOf('TOP') > -1) { noRefreshUnits.push('div-insticator-ad-1'); } if(hoverUnits.indexOf('BOTTOM') > -1) { noRefreshUnits.push('div-insticator-ad-2'); } } insticator_refreshBids(noRefreshUnits, Insticator.ad.settings.excludeClickRefreshAdX, Insticator.ad.settings.impressionType.EVENT_BASED_REFRESH); resetAutoRefreshTimer(); } }; var queue=Insticator.ad.q; var appendAd=function(containerId) { if(Insticator.blockAds) { Insticator.logger.logMessage("This geo is blocked initial load."); } else { var adUnitsSize=JSON.parse(adUnitSizeListJsonString); var adSize=adUnitsSize[containerId]; if (typeof adSize !== "undefined") { var existingStyle=document.getElementById(containerId).style.cssText; var style="width:" + adSize["width"] + "px;height:" + adSize["height"] + "px;"; document.getElementById(containerId).setAttribute("style", existingStyle + style); Insticator.logger.logMessage("Display ad for: " + containerId); var hasFill=containerId in Insticator.ad.hbFills; if (hasFill) { Insticator.logger.logMessage("Fill for: " + containerId + " with adId:" + Insticator.ad.hbFills[containerId].adId + " from: " + Insticator.ad.hbFills[containerId].bidderCode + " at cpm: " + Insticator.ad.hbFills[containerId].cpm + " boost to: " + Insticator.ad.hbFills[containerId].boostedCPM); insticator_SetAdXFloorTargeting(containerId, Insticator.ad.hbFills[containerId].boostedCPM); } else { Insticator.logger.logMessage("No fill for: " + containerId); insticator_SetAdXFloorTargeting(containerId, 1); } var passbackName=insticator_getPassbackName(containerId); Insticator.logger.logMessage("In appendAd, passbackName: " + passbackName); Insticator.logger.logMessage("hasFill: " + hasFill); if (!hasFill && passbackName.toLowerCase() !== "default") { insticator_showPassbackInIframe(containerId, passbackName, adSize["width"], adSize["height"]); } else { insticator_setNoFillTargeting(containerId); insticator_setImpressionTypeTargeting(containerId, Insticator.ad.settings.impressionType.INITIAL_LOAD); divsWithAdsShowInDFPForFirstTime.push(containerId); googletag.cmd.push(function () { googletag.display(containerId); }); } } } }; Insticator.ad.loadAd = function(containerId) { if(Insticator.ad.ready) { appendAd(containerId); } else { Insticator.logger.logMessage("Add to queue: " + containerId); queue.push(containerId); } }; Insticator.ad.action = function(e) { switch (e.data.action) { case "refreshAd": var hoverUnits=e.data.hoverUnits; refreshAdBasedOnClickEvent(hoverUnits); break; } }; Insticator.ad.loadAllAds = function() { Insticator.logger.logMessage("Load all ads"); queue.forEach(function(containerId) { appendAd(containerId); }); }; var refreshAdBasedOnTime=function() { var noRefreshUnits=[]; var platformHoverAds=[]; if(Insticator.tracking.variables.embedUUID !== "UNKNOWN") { platformHoverAds=Insticator.ad.settings.embedOverlayAd[Insticator.tracking.variables.embedUUID]; } else if(Object.keys(Insticator.ad.settings.embedOverlayAd).length === 1) { platformHoverAds=Insticator.ad.settings.embedOverlayAd[Object.keys(Insticator.ad.settings.embedOverlayAd)[0]]; } if(Object.keys(platformHoverAds).length > 0) { if(!Insticator.helper.isMobileDevice) { noRefreshUnits = platformHoverAds["web"]; } else { noRefreshUnits = platformHoverAds["mobile"]; } } insticator_refreshBids(noRefreshUnits, Insticator.ad.settings.excludeAutoRefreshAdX, Insticator.ad.settings.impressionType.TIME_BASED_REFRESH); }; var getAutoRefreshInterval = function() { var interval = Math.floor(Math.random() * (Insticator.ad.settings.autoRefreshIntervalUpperBound - Insticator.ad.settings.autoRefreshIntervalLowerBound) ) + Insticator.ad.settings.autoRefreshIntervalLowerBound; return interval; }; var autoRefreshAd = function() { if(Insticator.ad.settings.autoRefreshCounter++ < Insticator.ad.settings.autoRefreshCap) { refreshAdBasedOnTime(); resetAutoRefreshTimer(); } else { Insticator.logger.logMessage("Reach auto refresh cap, stop refreshing ad."); clearInterval(autoRefreshTimer); } }; var resetAutoRefreshTimer=function() { Insticator.logger.logMessage("resetAutoRefreshTimer"); clearInterval(autoRefreshTimer); autoRefreshTimer=setInterval(autoRefreshAd, getAutoRefreshInterval()); }; if(Insticator.blockAds) { Insticator.logger.logMessage("This geo is blocked for time based refresh."); } else { var autoRefreshTimer=setInterval(autoRefreshAd, getAutoRefreshInterval()); } }()); window.addEventListener("message", Insticator.ad.action, false); } catch(e) { console.error("header code error: ", e.message); } var insticatorQueue=window["Insticator"]["q"]; if(insticatorQueue && insticatorQueue.length>0) { for(var i=0; i < insticatorQueue.length; i++) { if(insticatorQueue[i]["t"] === "em") { var embedUUID = insticatorQueue[i]["o"]["id"]; embedLoad(embedUUID); } } } else { window["Insticator"]["load"] = function(t, o) { var embedUUID = o["id"]; embedLoad(embedUUID); } } function embedLoad(embedUUID) { console.log("Prepare to load embed: ", embedUUID); var targetDiv = document.querySelector("div[embed-id='" + embedUUID + "']"); if(targetDiv) { appendEmbedElements(targetDiv, embedUUID); } else { targetDiv = document.querySelector("div[id='insticator-embed']:not([embed-id])"); if(targetDiv) { appendEmbedElements(targetDiv, embedUUID); } else { console.log("Cannot find the proper div."); } } }; function appendEmbedElements(targetElement, embedUUID) { var iFrame = document.createElement("iframe"); iFrame.frameBorder = "0"; iFrame.scrolling = "no"; iFrame.marginheight = "0"; iFrame.marginwidth = "0"; iFrame.topmargin = "0"; iFrame.leftmargin = "0"; iFrame.id = "insticator-iframe"; iFrame.allowtransparency = "true"; targetElement.appendChild(iFrame); window.setTimeout(function(){ var div = iFrame.contentWindow.document.createElement("div"); div.id = "app"; iFrame.contentWindow.document.body.appendChild(div); var script = iFrame.contentWindow.document.createElement("script"); script.type = "text/javascript"; script.src = "https://d3lcz8vpax4lo2.cloudfront.net/embed-code/" + embedUUID + ".js"; iFrame.contentWindow.document.head.appendChild(script); },500); };